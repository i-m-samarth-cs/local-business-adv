<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Business Advisor</title>
    <link rel="icon" href="icon.png" type="image/png" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            color: #f7fafc;
            margin-bottom: 40px;
            padding: 50px 30px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 24px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(148, 163, 184, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #f7fafc, #cbd5e0, #a0aec0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            position: relative;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.8;
            font-weight: 400;
            color: #94a3b8;
        }

        .search-section {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(148, 163, 184, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            position: relative;
        }

        .search-input-wrapper {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 20px 60px 20px 24px;
            border: 2px solid rgba(71, 85, 105, 0.5);
            border-radius: 16px;
            font-size: 16px;
            background: rgba(30, 41, 59, 0.8);
            color: #f1f5f9;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .search-input::placeholder {
            color: #64748b;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), 0 8px 32px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
            background: rgba(30, 41, 59, 0.95);
        }

        .search-icon {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 20px;
        }

        .search-btn {
            padding: 20px 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .search-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .search-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .quick-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-select {
            padding: 14px 18px;
            border: 2px solid rgba(71, 85, 105, 0.5);
            border-radius: 14px;
            font-size: 14px;
            background: rgba(30, 41, 59, 0.8);
            color: #f1f5f9;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .loading {
            text-align: center;
            padding: 80px 20px;
            color: #cbd5e0;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(203, 213, 224, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-header {
            color: #f7fafc;
            text-align: center;
            margin-bottom: 40px;
        }

        .results-header h2 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #f7fafc, #cbd5e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .business-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 30px;
        }

        .business-card {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 0;
            transition: all 0.4s ease;
            border: 1px solid rgba(148, 163, 184, 0.1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .business-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        }

        .business-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .business-image {
            width: 100%;
            height: 220px;
            background-size: cover;
            background-position: center;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .business-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.8), transparent);
        }

        .business-content {
            padding: 30px;
        }

        .business-header {
            margin-bottom: 20px;
        }

        .business-header h3 {
            font-size: 1.5rem;
            font-weight: 800;
            color: #f7fafc;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .business-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .category {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .location {
            color: #94a3b8;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .description {
            color: #cbd5e0;
            line-height: 1.7;
            margin-bottom: 25px;
            font-size: 15px;
        }

        .business-details {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }

        .detail-row {
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .detail-row:last-child {
            margin-bottom: 0;
        }

        .detail-row strong {
            color: #e2e8f0;
            min-width: 90px;
            flex-shrink: 0;
            font-weight: 700;
        }

        .detail-row span {
            color: #94a3b8;
        }

        .tags {
            margin-bottom: 25px;
        }

        .tag {
            display: inline-block;
            background: rgba(71, 85, 105, 0.5);
            color: #cbd5e0;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin: 3px 6px 3px 0;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .tag:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .business-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 25px;
            border-top: 2px solid rgba(71, 85, 105, 0.3);
        }

        .rating {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .stars {
            color: #fbbf24;
            font-size: 18px;
            letter-spacing: 2px;
        }

        .rating-text {
            color: #94a3b8;
            font-size: 13px;
            font-weight: 600;
        }

        .match-score {
            text-align: right;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .recent-review {
            background: rgba(30, 41, 59, 0.6);
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 16px;
            margin-top: 25px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .recent-review h4 {
            font-size: 14px;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 10px;
        }

        .recent-review p {
            font-style: italic;
            color: #94a3b8;
            line-height: 1.6;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .recent-review small {
            color: #64748b;
            font-weight: 600;
        }

        .no-results, .error {
            text-align: center;
            padding: 80px 40px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .no-results h3, .error h3 {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: #e2e8f0;
        }

        .error {
            border-left: 4px solid #ef4444;
        }

        .error h3 {
            color: #ef4444;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.5rem;
            }

            .search-container {
                flex-direction: column;
            }

            .business-grid {
                grid-template-columns: 1fr;
            }

            .business-footer {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .match-score {
                align-self: flex-end;
            }
        }

        /* Animations */
        .business-card {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.6);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üåü Local Business Advisor</h1>
            <p>Discover exceptional local businesses tailored to your unique needs</p>
        </header>

        <section class="search-section">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search-input"
                        placeholder="What are you looking for? (e.g., 'coffee shop with wifi for work')"
                    >
                    <span class="search-icon">üîç</span>
                </div>
                <button id="searchBtn" class="search-btn">Search</button>
            </div>
            
            <div class="quick-filters">
                <select id="categoryFilter" class="filter-select">
                    <option value="">All Categories</option>
                    <option value="Restaurant">üçΩÔ∏è Restaurant</option>
                    <option value="Cafe">‚òï Cafe</option>
                    <option value="Electronics">‚ö° Electronics</option>
                    <option value="Healthcare">üè• Healthcare</option>
                    <option value="Retail">üõçÔ∏è Retail</option>
                    <option value="Grocery">ü•¨ Grocery</option>
                    <option value="Services">üîß Services</option>
                </select>
                
                <select id="locationFilter" class="filter-select">
                    <option value="">All Locations</option>
                    <option value="Koregaon Park">üìç Koregaon Park</option>
                    <option value="FC Road">üìç FC Road</option>
                    <option value="Aundh">üìç Aundh</option>
                    <option value="Deccan">üìç Deccan</option>
                    <option value="Kothrud">üìç Kothrud</option>
                </select>
                
                <select id="priceFilter" class="filter-select">
                    <option value="">Any Price Range</option>
                    <option value="$">üí∞ Budget (‚Çπ)</option>
                    <option value="$$">üí∞üí∞ Moderate (‚Çπ‚Çπ)</option>
                    <option value="$$$">üí∞üí∞üí∞ Expensive (‚Çπ‚Çπ‚Çπ)</option>
                    <option value="$$$$">üí∞üí∞üí∞üí∞ Premium (‚Çπ‚Çπ‚Çπ‚Çπ)</option>
                </select>
            </div>
        </section>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Finding the perfect businesses for you...</p>
        </div>

        <section id="results" class="results-section">
            <!-- Results will be populated here -->
        </section>
    </div>

    <script>
        // Demo Data Service
        class DemoDataService {
            constructor() {
                this.demoBusinesses = [
                    {
                        uid: 'b1',
                        business_name: 'Artisan Coffee Roasters',
                        category: 'Cafe',
                        location: 'Koregaon Park',
                        description: 'Premium specialty coffee roasted daily with artisan pastries and a cozy atmosphere perfect for work or meetings.',
                        services: ['Free WiFi', 'Laptop Friendly', 'Fresh Pastries', 'Specialty Coffee'],
                        price_range: '$$',
                        operating_hours: '7:00 AM - 11:00 PM',
                        phone: '+91 9876543210',
                        tags: ['wifi', 'work-friendly', 'artisan', 'coffee', 'pastries', 'quiet'],
                        image: 'https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b2',
                        business_name: 'Tech Hub Electronics',
                        category: 'Electronics',
                        location: 'FC Road',
                        description: 'Your one-stop destination for latest gadgets, smartphones, laptops, and computer accessories with expert technical support.',
                        services: ['Repair Services', 'Technical Support', 'Home Delivery', 'Warranty Support'],
                        price_range: '$$$',
                        operating_hours: '10:00 AM - 9:00 PM',
                        phone: '+91 9876543211',
                        tags: ['gadgets', 'smartphones', 'laptops', 'repair', 'warranty', 'technical-support'],
                        image: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b3',
                        business_name: 'Spice Garden Restaurant',
                        category: 'Restaurant',
                        location: 'Aundh',
                        description: 'Authentic Indian cuisine with traditional recipes passed down through generations, featuring organic ingredients and regional specialties.',
                        services: ['Dine-in', 'Takeaway', 'Home Delivery', 'Catering'],
                        price_range: '$$',
                        operating_hours: '11:00 AM - 11:00 PM',
                        phone: '+91 9876543212',
                        tags: ['indian-cuisine', 'authentic', 'organic', 'spices', 'traditional', 'catering'],
                        image: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b4',
                        business_name: 'Green Valley Pharmacy',
                        category: 'Healthcare',
                        location: 'Deccan',
                        description: 'Complete healthcare pharmacy with licensed pharmacists, health consultations, and 24/7 emergency medicine delivery.',
                        services: ['Prescription Filling', 'Health Consultation', '24/7 Delivery', 'Health Check-ups'],
                        price_range: '$',
                        operating_hours: '24 Hours',
                        phone: '+91 9876543213',
                        tags: ['pharmacy', '24-hours', 'consultation', 'delivery', 'health', 'medicine'],
                        image: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b5',
                        business_name: 'Style Studio Boutique',
                        category: 'Retail',
                        location: 'Kothrud',
                        description: 'Trendy fashion boutique featuring designer clothing, accessories, and personalized styling services for all occasions.',
                        services: ['Personal Styling', 'Custom Tailoring', 'Seasonal Collections', 'Accessories'],
                        price_range: '$$$',
                        operating_hours: '10:00 AM - 8:00 PM',
                        phone: '+91 9876543214',
                        tags: ['fashion', 'designer', 'styling', 'trendy', 'accessories', 'boutique'],
                        image: 'https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b6',
                        business_name: 'Fresh Market Grocery',
                        category: 'Grocery',
                        location: 'Koregaon Park',
                        description: 'Premium grocery store with organic produce, international foods, and fresh daily essentials with same-day delivery.',
                        services: ['Organic Produce', 'International Foods', 'Home Delivery', 'Fresh Bakery'],
                        price_range: '$$',
                        operating_hours: '6:00 AM - 11:00 PM',
                        phone: '+91 9876543215',
                        tags: ['organic', 'fresh', 'international', 'delivery', 'bakery', 'premium'],
                        image: 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b7',
                        business_name: 'Urban Zen Spa',
                        category: 'Services',
                        location: 'FC Road',
                        description: 'Luxury wellness spa offering therapeutic massages, beauty treatments, and holistic wellness programs in a serene environment.',
                        services: ['Therapeutic Massage', 'Beauty Treatments', 'Wellness Programs', 'Aromatherapy'],
                        price_range: '$$$$',
                        operating_hours: '9:00 AM - 9:00 PM',
                        phone: '+91 9876543216',
                        tags: ['spa', 'wellness', 'massage', 'beauty', 'relaxation', 'luxury'],
                        image: 'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        uid: 'b8',
                        business_name: 'Brew & Bytes Cafe',
                        category: 'Cafe',
                        location: 'Aundh',
                        description: 'Modern cafe combining excellent coffee with co-working space, high-speed internet, and tech meetup events.',
                        services: ['Co-working Space', 'High-speed WiFi', 'Tech Events', 'Premium Coffee'],
                        price_range: '$$',
                        operating_hours: '8:00 AM - 12:00 AM',
                        phone: '+91 9876543217',
                        tags: ['coworking', 'tech', 'wifi', 'events', 'modern', 'networking'],
                        image: 'https://images.unsplash.com/photo-1554118811-1e0d58224f24?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    }
                ];

                this.demoReviews = [
                    {
                        uid: 'r1',
                        business_ref: { uid: 'b1' },
                        reviewer_name: 'Sarah M.',
                        rating: 5,
                        review_text: 'Amazing coffee and perfect atmosphere for working. The baristas know their craft!'
                    },
                    {
                        uid: 'r2',
                        business_ref: { uid: 'b1' },
                        reviewer_name: 'Mike R.',
                        rating: 4,
                        review_text: 'Great place to meet clients. Excellent WiFi and comfortable seating.'
                    },
                    {
                        uid: 'r3',
                        business_ref: { uid: 'b2' },
                        reviewer_name: 'Priya S.',
                        rating: 5,
                        review_text: 'Best place for electronics in Pune. Great prices and excellent service.'
                    },
                    {
                        uid: 'r4',
                        business_ref: { uid: 'b3' },
                        reviewer_name: 'Raj K.',
                        rating: 4,
                        review_text: 'Authentic flavors that remind me of home. Highly recommend the biryani!'
                    },
                    {
                        uid: 'r5',
                        business_ref: { uid: 'b4' },
                        reviewer_name: 'Lisa D.',
                        rating: 5,
                        review_text: '24/7 service saved my day during an emergency. Very professional staff.'
                    },
                    {
                        uid: 'r6',
                        business_ref: { uid: 'b5' },
                        reviewer_name: 'Anita J.',
                        rating: 4,
                        review_text: 'Love their styling services. Always find unique pieces here.'
                    },
                    {
                        uid: 'r7',
                        business_ref: { uid: 'b6' },
                        reviewer_name: 'Tom H.',
                        rating: 5,
                        review_text: 'Fresh organic produce and great variety. Delivery is always on time.'
                    },
                    {
                        uid: 'r8',
                        business_ref: { uid: 'b7' },
                        reviewer_name: 'Maya P.',
                        rating: 5,
                        review_text: 'Most relaxing spa experience ever. The aromatherapy session was divine.'
                    },
                    {
                        uid: 'r9',
                        business_ref: { uid: 'b8' },
                        reviewer_name: 'Alex C.',
                        rating: 4,
                        review_text: 'Perfect for developers! Great coffee, fast internet, and awesome tech meetups.'
                    }
                ];
            }

            async getAllBusinesses() {
                return new Promise(resolve => {
                    setTimeout(() => resolve(this.demoBusinesses), 500);
                });
            }

            async getAllReviews() {
                return new Promise(resolve => {
                    setTimeout(() => resolve(this.demoReviews), 300);
                });
            }

            async testConnection() {
                console.log('Demo data loaded successfully!');
                return true;
            }
        }

        // Enhanced Search Engine
        class AdvancedSearchEngine {
            constructor(dataService) {
                this.dataService = dataService;
                this.allBusinesses = [];
                this.allReviews = [];
            }

            async initialize() {
                this.allBusinesses = await this.dataService.getAllBusinesses();
                this.allReviews = await this.dataService.getAllReviews();
                console.log(`Loaded ${this.allBusinesses.length} businesses and ${this.allReviews.length} reviews`);
            }

            smartSearch(query, filters = {}) {
                if (!query && !this.hasFilters(filters)) {
                    return this.allBusinesses.map(business => ({
                        business,
                        score: Math.floor(Math.random() * 50) + 50,
                        reviews: this.getBusinessReviews(business.uid)
                    }));
                }

                let results = [];

                if (query) {
                    const queryWords = query.toLowerCase().split(' ');
                    results = this.allBusinesses.map(business => {
                        let score = 0;
                        const searchText = this.createSearchableText(business).toLowerCase();

                        queryWords.forEach(word => {
                            // Exact matches in name get highest score
                            if (business.business_name && business.business_name.toLowerCase().includes(word)) {
                                score += 10;
                            }
                            
                            // Category matches get high score
                            if (business.category && business.category.toLowerCase().includes(word)) {
                                score += 8;
                            }
                            
                            // Service matches
                            if (business.services && business.services.some(service => 
                                service.toLowerCase().includes(word))) {
                                score += 6;
                            }
                            
                            // Tag matches
                            if (business.tags && business.tags.some(tag => 
                                tag.toLowerCase().includes(word))) {
                                score += 4;
                            }
                            
                            // Description matches
                            if (business.description && business.description.toLowerCase().includes(word)) {
                                score += 3;
                            }
                            
                            // Location matches
                            if (business.location && business.location.toLowerCase().includes(word)) {
                                score += 2;
                            }
                        });

                        return {
                            business,
                            score,
                            reviews: this.getBusinessReviews(business.uid)
                        };
                    }).filter(result => result.score > 0);
                } else {
                    results = this.allBusinesses.map(business => ({
                        business,
                        score: Math.floor(Math.random() * 30) + 20,
                        reviews: this.getBusinessReviews(business.uid)
                    }));
                }

                // Apply filters
                results = results.filter(result => this.matchesFilters(result.business, filters));
                
                // Sort by score
                results.sort((a, b) => b.score - a.score);

                return results;
            }

            hasFilters(filters) {
                return filters.category || filters.location || filters.priceRange;
            }

            createSearchableText(business) {
                const reviews = this.getBusinessReviews(business.uid);
                const reviewTexts = reviews.map(r => r.review_text || '').join(' ');
                const services = Array.isArray(business.services) ? business.services.join(' ') : (business.services || '');
                const tags = Array.isArray(business.tags) ? business.tags.join(' ') : (business.tags || '');

                return `${business.business_name || ''} ${business.description || ''} ${business.category || ''} ${services} ${tags} ${reviewTexts}`;
            }

            getBusinessReviews(businessUid) {
                return this.allReviews.filter(review => 
                    review.business_ref && review.business_ref.uid === businessUid
                );
            }

            matchesFilters(business, filters) {
                if (filters.category && business.category !== filters.category) {
                    return false;
                }

                if (filters.location && !business.location.includes(filters.location)) {
                    return false;
                }

                if (filters.priceRange && business.price_range !== filters.priceRange) {
                    return false;
                }

                return true;
            }
        }

        // Enhanced Main Application
        class BusinessAdvisorApp {
            constructor() {
                this.dataService = new DemoDataService();
                this.searchEngine = new AdvancedSearchEngine(this.dataService);
                this.isLoading = false;
                
                this.initializeEventListeners();
                this.initialize();
            }

            async initialize() {
                this.showLoading(true, 'Loading amazing businesses...');
                await this.searchEngine.initialize();
                this.showLoading(false);
                
                // Show all businesses initially
                this.performSearch();
            }

            initializeEventListeners() {
                const searchBtn = document.getElementById('searchBtn');
                const searchInput = document.getElementById('searchInput');
                const categoryFilter = document.getElementById('categoryFilter');
                const locationFilter = document.getElementById('locationFilter');
                const priceFilter = document.getElementById('priceFilter');

                searchBtn.addEventListener('click', () => this.performSearch());
                
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.performSearch();
                });

                searchInput.addEventListener('input', (e) => {
                    if (e.target.value === '') {
                        this.performSearch();
                    }
                });

                [categoryFilter, locationFilter, priceFilter].forEach(filter => {
                    filter.addEventListener('change', () => this.performSearch());
                });
            }

            async performSearch() {
                if (this.isLoading) return;

                const query = document.getElementById('searchInput').value.trim();
                const filters = {
                    category: document.getElementById('categoryFilter').value,
                    location: document.getElementById('locationFilter').value,
                    priceRange: document.getElementById('priceFilter').value
                };

                this.showLoading(true, 'Finding perfect matches...');
                
                try {
                    // Add small delay for better UX
                    await new Promise(resolve => setTimeout(resolve, 800));
                    const results = this.searchEngine.smartSearch(query, filters);
                    this.displayResults(results, query);
                } catch (error) {
                    console.error('Search error:', error);
                    this.displayError('Sorry, something went wrong. Please try again.');
                } finally {
                    this.showLoading(false);
                }
            }

            displayResults(results, query) {
                const resultsContainer = document.getElementById('results');
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="no-results">
                            <h3>üîç No businesses found</h3>
                            <p>Try adjusting your search terms or filters to discover more amazing businesses.</p>
                        </div>
                    `;
                    return;
                }

                const resultsHTML = `
                    <div class="results-header">
                        <h2>‚ú® Found ${results.length} exceptional ${results.length === 1 ? 'match' : 'matches'}${query ? ` for "${query}"` : ''}</h2>
                        <p>Curated and sorted by relevance to your needs</p>
                    </div>
                    <div class="business-grid">
                        ${results.map(result => this.createBusinessCard(result)).join('')}
                    </div>
                `;

                resultsContainer.innerHTML = resultsHTML;
            }

            createBusinessCard(result) {
                const business = result.business;
                const reviews = result.reviews || [];
                const avgRating = reviews.length > 0 
                    ? (reviews.reduce((sum, r) => sum + (r.rating || 0), 0) / reviews.length).toFixed(1)
                    : '4.5';

                const services = Array.isArray(business.services) 
                    ? business.services.slice(0, 4).join(', ')
                    : (business.services || 'Premium services available');

                const tags = Array.isArray(business.tags)
                    ? business.tags.slice(0, 6).map(tag => `<span class="tag">${tag}</span>`).join('')
                    : '';

                const imageUrl = business.image || 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';

                return `
                    <div class="business-card">
                        <div class="business-image" style="background-image: url('${imageUrl}')"></div>
                        
                        <div class="business-content">
                            <div class="business-header">
                                <h3>${business.business_name || 'Premium Business'}</h3>
                                <div class="business-meta">
                                    <span class="category">${business.category || 'Featured'}</span>
                                    <span class="location">üìç ${business.location || 'Prime Location'}</span>
                                </div>
                            </div>

                            <p class="description">${business.description || 'Exceptional service and premium quality experience awaits you.'}</p>
                            
                            <div class="business-details">
                                <div class="detail-row">
                                    <strong>Services:</strong> <span>${services}</span>
                                </div>
                                
                                ${business.price_range ? `
                                    <div class="detail-row">
                                        <strong>Price:</strong> <span>${business.price_range}</span>
                                    </div>
                                ` : ''}
                                
                                ${business.operating_hours ? `
                                    <div class="detail-row">
                                        <strong>Hours:</strong> <span>${business.operating_hours}</span>
                                    </div>
                                ` : ''}
                                
                                ${business.phone ? `
                                    <div class="detail-row">
                                        <strong>Phone:</strong> <span>${business.phone}</span>
                                    </div>
                                ` : ''}
                            </div>

                            ${tags ? `<div class="tags">${tags}</div>` : ''}

                            <div class="business-footer">
                                <div class="rating">
                                    <div class="stars">${this.generateStars(parseFloat(avgRating))}</div>
                                    <div class="rating-text">${avgRating} ‚≠ê (${reviews.length} reviews)</div>
                                </div>
                                
                                ${result.score ? `
                                    <div class="match-score">
                                        ${Math.min(100, Math.round(result.score * 8) + 15)}% Match
                                    </div>
                                ` : ''}
                            </div>

                            ${reviews.length > 0 ? `
                                <div class="recent-review">
                                    <h4>üí¨ Latest Review</h4>
                                    <p>"${reviews[0].review_text}"</p>
                                    <small>‚Äî ${reviews[0].reviewer_name}</small>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            generateStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                let stars = '';
                
                for (let i = 0; i < fullStars; i++) {
                    stars += '‚≠ê';
                }
                
                if (hasHalfStar && fullStars < 5) {
                    stars += '‚≠ê';
                }
                
                // Ensure at least 3 stars for demo purposes
                while (stars.length < 6) {
                    stars += '‚≠ê';
                }
                
                return stars;
            }

            showLoading(show, message = 'Finding the perfect businesses for you...') {
                this.isLoading = show;
                const loading = document.getElementById('loading');
                const searchBtn = document.getElementById('searchBtn');
                
                if (show) {
                    loading.classList.remove('hidden');
                    loading.querySelector('p').textContent = message;
                    searchBtn.textContent = 'Searching...';
                    searchBtn.disabled = true;
                } else {
                    loading.classList.add('hidden');
                    searchBtn.textContent = 'Search';
                    searchBtn.disabled = false;
                }
            }

            displayError(message) {
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = `
                    <div class="error">
                        <h3>‚ö†Ô∏è Oops! Something went wrong</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new BusinessAdvisorApp();
        });
    </script>
</body>
</html>